import{aW as m,c9 as oe,z as x,$ as U,r as g,b9 as M,S as ee,_ as re,e as ce,l as ae,w as R,m as y,a7 as ue,aa as q,g as ie,G as de}from"./index-Cq0hu8dX.js";const le=(e,n)=>{if(!m)return!1;const t={undefined:"overflow",true:"overflow-y",false:"overflow-x"}[String(n)],s=oe(e,t);return["scroll","auto","overlay"].some(r=>s.includes(r))},Ae=(e,n)=>{if(!m)return;let t=e;for(;t;){if([window,document,document.documentElement].includes(t))return window;if(le(t,n))return t;t=t.parentNode}return t};let F;const Ne=e=>{var n;if(!m)return 0;if(F!==void 0)return F;const t=document.createElement("div");t.className=`${e}-scrollbar__wrap`,t.style.visibility="hidden",t.style.width="100px",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const s=t.offsetWidth;t.style.overflow="scroll";const r=document.createElement("div");r.style.width="100%",t.appendChild(r);const a=r.offsetWidth;return(n=t.parentNode)==null||n.removeChild(t),F=s-a,F};function Oe(e,n){if(!m)return;if(!n){e.scrollTop=0;return}const t=[];let s=n.offsetParent;for(;s!==null&&e!==s&&e.contains(s);)t.push(s),s=s.offsetParent;const r=n.offsetTop+t.reduce((b,T)=>b+T.offsetTop,0),a=r+n.offsetHeight,l=e.scrollTop,p=l+e.clientHeight;r<l?e.scrollTop=r:a>p&&(e.scrollTop=a-e.clientHeight)}const fe='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',ve=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,Re=e=>Array.from(e.querySelectorAll(fe)).filter(n=>te(n)&&ve(n)),te=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true")return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},Ie=function(e,n,...t){let s;n.includes("mouse")||n.includes("click")?s="MouseEvents":n.includes("key")?s="KeyboardEvent":s="HTMLEvents";const r=document.createEvent(s);return r.initEvent(n,...t),e.dispatchEvent(r),e},I="focus-trap.focus-after-trapped",k="focus-trap.focus-after-released",pe="focus-trap.focusout-prevented",j={cancelable:!0,bubbles:!1},Ee={cancelable:!0,bubbles:!1},z="focusAfterTrapped",G="focusAfterReleased",me=Symbol("elFocusTrap"),K=g(),L=g(0),B=g(0);let w=0;const ne=e=>{const n=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0||s===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)n.push(t.currentNode);return n},J=(e,n)=>{for(const t of e)if(!be(t,n))return t},be=(e,n)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},Te=e=>{const n=ne(e),t=J(n,e),s=J(n.reverse(),e);return[t,s]},he=e=>e instanceof HTMLInputElement&&"select"in e,v=(e,n)=>{if(e&&e.focus){const t=document.activeElement;let s=!1;M(e)&&!te(e)&&!e.getAttribute("tabindex")&&(e.setAttribute("tabindex","-1"),s=!0),e.focus({preventScroll:!0}),B.value=window.performance.now(),e!==t&&he(e)&&n&&e.select(),M(e)&&s&&e.removeAttribute("tabindex")}};function X(e,n){const t=[...e],s=e.indexOf(n);return s!==-1&&t.splice(s,1),t}const ye=()=>{let e=[];return{push:s=>{const r=e[0];r&&s!==r&&r.pause(),e=X(e,s),e.unshift(s)},remove:s=>{var r,a;e=X(e,s),(a=(r=e[0])==null?void 0:r.resume)==null||a.call(r)}}},Fe=(e,n=!1)=>{const t=document.activeElement;for(const s of e)if(v(s,n),document.activeElement!==t)return},Y=ye(),we=()=>L.value>B.value,S=()=>{K.value="pointer",L.value=window.performance.now()},Q=()=>{K.value="keyboard",L.value=window.performance.now()},Se=()=>(x(()=>{w===0&&(document.addEventListener("mousedown",S),document.addEventListener("touchstart",S),document.addEventListener("keydown",Q)),w++}),U(()=>{w--,w<=0&&(document.removeEventListener("mousedown",S),document.removeEventListener("touchstart",S),document.removeEventListener("keydown",Q))}),{focusReason:K,lastUserFocusTimestamp:L,lastAutomatedFocusTimestamp:B}),_=e=>new CustomEvent(pe,{...Ee,detail:e});let E=[];const Z=e=>{e.code===ee.esc&&E.forEach(n=>n(e))},_e=e=>{x(()=>{E.length===0&&document.addEventListener("keydown",Z),m&&E.push(e)}),U(()=>{E=E.filter(n=>n!==e),E.length===0&&m&&document.removeEventListener("keydown",Z)})},ge=ce({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[z,G,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:n}){const t=g();let s,r;const{focusReason:a}=Se();_e(o=>{e.trapped&&!l.paused&&n("release-requested",o)});const l={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},p=o=>{if(!e.loop&&!e.trapped||l.paused)return;const{code:c,altKey:u,ctrlKey:i,metaKey:d,currentTarget:V,shiftKey:W}=o,{loop:$}=e,se=c===ee.tab&&!u&&!i&&!d,h=document.activeElement;if(se&&h){const A=V,[N,O]=Te(A);if(N&&O){if(!W&&h===O){const f=_({focusReason:a.value});n("focusout-prevented",f),f.defaultPrevented||(o.preventDefault(),$&&v(N,!0))}else if(W&&[N,A].includes(h)){const f=_({focusReason:a.value});n("focusout-prevented",f),f.defaultPrevented||(o.preventDefault(),$&&v(O,!0))}}else if(h===A){const f=_({focusReason:a.value});n("focusout-prevented",f),f.defaultPrevented||o.preventDefault()}}};de(me,{focusTrapRef:t,onKeydown:p}),R(()=>e.focusTrapEl,o=>{o&&(t.value=o)},{immediate:!0}),R([t],([o],[c])=>{o&&(o.addEventListener("keydown",p),o.addEventListener("focusin",P),o.addEventListener("focusout",C)),c&&(c.removeEventListener("keydown",p),c.removeEventListener("focusin",P),c.removeEventListener("focusout",C))});const b=o=>{n(z,o)},T=o=>n(G,o),P=o=>{const c=y(t);if(!c)return;const u=o.target,i=o.relatedTarget,d=u&&c.contains(u);e.trapped||i&&c.contains(i)||(s=i),d&&n("focusin",o),!l.paused&&e.trapped&&(d?r=u:v(r,!0))},C=o=>{const c=y(t);if(!(l.paused||!c))if(e.trapped){const u=o.relatedTarget;!ue(u)&&!c.contains(u)&&setTimeout(()=>{if(!l.paused&&e.trapped){const i=_({focusReason:a.value});n("focusout-prevented",i),i.defaultPrevented||v(r,!0)}},0)}else{const u=o.target;u&&c.contains(u)||n("focusout",o)}};async function D(){await q();const o=y(t);if(o){Y.push(l);const c=o.contains(document.activeElement)?s:document.activeElement;if(s=c,!o.contains(c)){const i=new Event(I,j);o.addEventListener(I,b),o.dispatchEvent(i),i.defaultPrevented||q(()=>{let d=e.focusStartEl;ie(d)||(v(d),document.activeElement!==d&&(d="first")),d==="first"&&Fe(ne(o),!0),(document.activeElement===c||d==="container")&&v(o)})}}}function H(){const o=y(t);if(o){o.removeEventListener(I,b);const c=new CustomEvent(k,{...j,detail:{focusReason:a.value}});o.addEventListener(k,T),o.dispatchEvent(c),!c.defaultPrevented&&(a.value=="keyboard"||!we()||o.contains(document.activeElement))&&v(s??document.body),o.removeEventListener(k,T),Y.remove(l)}}return x(()=>{e.trapped&&D(),R(()=>e.trapped,o=>{o?D():H()})}),U(()=>{e.trapped&&H(),t.value&&(t.value.removeEventListener("keydown",p),t.value.removeEventListener("focusin",P),t.value.removeEventListener("focusout",C),t.value=void 0)}),{onKeydown:p}}});function Le(e,n,t,s,r,a){return ae(e.$slots,"default",{handleKeydown:e.onKeydown})}var ke=re(ge,[["render",Le],["__file","focus-trap.vue"]]);export{ke as E,me as F,Ne as a,v as b,Ae as g,te as i,Re as o,Oe as s,Ie as t};
