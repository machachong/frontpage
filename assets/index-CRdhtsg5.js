import{aO as st,ba as Q,r as I,z as at,bi as ut,j as nt,o as tt,J as Y,a1 as ot,at as lt,K as rt,e as ct,aI as dt,k as ft}from"./index-Cq0hu8dX.js";import{_ as pt}from"./_plugin-vue_export-helper-DlAUqK2U.js";var et={exports:{}},gt=et.exports,it;function ht(){return it||(it=1,function(D,A){(function(O,m){D.exports=m()})(gt,function(){var O=1e3,m=6e4,N=36e5,P="millisecond",y="second",S="minute",L="hour",T="day",E="week",b="month",U="quarter",k="year",C="date",X="Invalid Date",z=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,q=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,J={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(s){var t=["th","st","nd","rd"],e=s%100;return"["+s+(t[(e-20)%10]||t[e]||t[0])+"]"}},V=function(s,t,e){var r=String(s);return!r||r.length>=t?s:""+Array(t+1-r.length).join(e)+s},R={s:V,z:function(s){var t=-s.utcOffset(),e=Math.abs(t),r=Math.floor(e/60),n=e%60;return(t<=0?"+":"-")+V(r,2,"0")+":"+V(n,2,"0")},m:function s(t,e){if(t.date()<e.date())return-s(e,t);var r=12*(e.year()-t.year())+(e.month()-t.month()),n=t.clone().add(r,b),u=e-n<0,l=t.clone().add(r+(u?-1:1),b);return+(-(r+(e-n)/(u?n-l:l-n))||0)},a:function(s){return s<0?Math.ceil(s)||0:Math.floor(s)},p:function(s){return{M:b,y:k,w:E,d:T,D:C,h:L,m:S,s:y,ms:P,Q:U}[s]||String(s||"").toLowerCase().replace(/s$/,"")},u:function(s){return s===void 0}},F="en",a={};a[F]=J;var o="$isDayjsObject",d=function(s){return s instanceof g||!(!s||!s[o])},_=function s(t,e,r){var n;if(!t)return F;if(typeof t=="string"){var u=t.toLowerCase();a[u]&&(n=u),e&&(a[u]=e,n=u);var l=t.split("-");if(!n&&l.length>1)return s(l[0])}else{var p=t.name;a[p]=t,n=p}return!r&&n&&(F=n),n||!r&&F},c=function(s,t){if(d(s))return s.clone();var e=typeof t=="object"?t:{};return e.date=s,e.args=arguments,new g(e)},i=R;i.l=_,i.i=d,i.w=function(s,t){return c(s,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var g=function(){function s(e){this.$L=_(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[o]=!0}var t=s.prototype;return t.parse=function(e){this.$d=function(r){var n=r.date,u=r.utc;if(n===null)return new Date(NaN);if(i.u(n))return new Date;if(n instanceof Date)return new Date(n);if(typeof n=="string"&&!/Z$/i.test(n)){var l=n.match(z);if(l){var p=l[2]-1||0,h=(l[7]||"0").substring(0,3);return u?new Date(Date.UTC(l[1],p,l[3]||1,l[4]||0,l[5]||0,l[6]||0,h)):new Date(l[1],p,l[3]||1,l[4]||0,l[5]||0,l[6]||0,h)}}return new Date(n)}(e),this.init()},t.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},t.$utils=function(){return i},t.isValid=function(){return this.$d.toString()!==X},t.isSame=function(e,r){var n=c(e);return this.startOf(r)<=n&&n<=this.endOf(r)},t.isAfter=function(e,r){return c(e)<this.startOf(r)},t.isBefore=function(e,r){return this.endOf(r)<c(e)},t.$g=function(e,r,n){return i.u(e)?this[r]:this.set(n,e)},t.unix=function(){return Math.floor(this.valueOf()/1e3)},t.valueOf=function(){return this.$d.getTime()},t.startOf=function(e,r){var n=this,u=!!i.u(r)||r,l=i.p(e),p=function(x,M){var H=i.w(n.$u?Date.UTC(n.$y,M,x):new Date(n.$y,M,x),n);return u?H:H.endOf(T)},h=function(x,M){return i.w(n.toDate()[x].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(M)),n)},v=this.$W,$=this.$M,w=this.$D,B="set"+(this.$u?"UTC":"");switch(l){case k:return u?p(1,0):p(31,11);case b:return u?p(1,$):p(0,$+1);case E:var j=this.$locale().weekStart||0,W=(v<j?v+7:v)-j;return p(u?w-W:w+(6-W),$);case T:case C:return h(B+"Hours",0);case L:return h(B+"Minutes",1);case S:return h(B+"Seconds",2);case y:return h(B+"Milliseconds",3);default:return this.clone()}},t.endOf=function(e){return this.startOf(e,!1)},t.$set=function(e,r){var n,u=i.p(e),l="set"+(this.$u?"UTC":""),p=(n={},n[T]=l+"Date",n[C]=l+"Date",n[b]=l+"Month",n[k]=l+"FullYear",n[L]=l+"Hours",n[S]=l+"Minutes",n[y]=l+"Seconds",n[P]=l+"Milliseconds",n)[u],h=u===T?this.$D+(r-this.$W):r;if(u===b||u===k){var v=this.clone().set(C,1);v.$d[p](h),v.init(),this.$d=v.set(C,Math.min(this.$D,v.daysInMonth())).$d}else p&&this.$d[p](h);return this.init(),this},t.set=function(e,r){return this.clone().$set(e,r)},t.get=function(e){return this[i.p(e)]()},t.add=function(e,r){var n,u=this;e=Number(e);var l=i.p(r),p=function($){var w=c(u);return i.w(w.date(w.date()+Math.round($*e)),u)};if(l===b)return this.set(b,this.$M+e);if(l===k)return this.set(k,this.$y+e);if(l===T)return p(1);if(l===E)return p(7);var h=(n={},n[S]=m,n[L]=N,n[y]=O,n)[l]||1,v=this.$d.getTime()+e*h;return i.w(v,this)},t.subtract=function(e,r){return this.add(-1*e,r)},t.format=function(e){var r=this,n=this.$locale();if(!this.isValid())return n.invalidDate||X;var u=e||"YYYY-MM-DDTHH:mm:ssZ",l=i.z(this),p=this.$H,h=this.$m,v=this.$M,$=n.weekdays,w=n.months,B=n.meridiem,j=function(M,H,G,K){return M&&(M[H]||M(r,u))||G[H].slice(0,K)},W=function(M){return i.s(p%12||12,M,"0")},x=B||function(M,H,G){var K=M<12?"AM":"PM";return G?K.toLowerCase():K};return u.replace(q,function(M,H){return H||function(G){switch(G){case"YY":return String(r.$y).slice(-2);case"YYYY":return i.s(r.$y,4,"0");case"M":return v+1;case"MM":return i.s(v+1,2,"0");case"MMM":return j(n.monthsShort,v,w,3);case"MMMM":return j(w,v);case"D":return r.$D;case"DD":return i.s(r.$D,2,"0");case"d":return String(r.$W);case"dd":return j(n.weekdaysMin,r.$W,$,2);case"ddd":return j(n.weekdaysShort,r.$W,$,3);case"dddd":return $[r.$W];case"H":return String(p);case"HH":return i.s(p,2,"0");case"h":return W(1);case"hh":return W(2);case"a":return x(p,h,!0);case"A":return x(p,h,!1);case"m":return String(h);case"mm":return i.s(h,2,"0");case"s":return String(r.$s);case"ss":return i.s(r.$s,2,"0");case"SSS":return i.s(r.$ms,3,"0");case"Z":return l}return null}(M)||l.replace(":","")})},t.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},t.diff=function(e,r,n){var u,l=this,p=i.p(r),h=c(e),v=(h.utcOffset()-this.utcOffset())*m,$=this-h,w=function(){return i.m(l,h)};switch(p){case k:u=w()/12;break;case b:u=w();break;case U:u=w()/3;break;case E:u=($-v)/6048e5;break;case T:u=($-v)/864e5;break;case L:u=$/N;break;case S:u=$/m;break;case y:u=$/O;break;default:u=$}return n?u:i.a(u)},t.daysInMonth=function(){return this.endOf(b).$D},t.$locale=function(){return a[this.$L]},t.locale=function(e,r){if(!e)return this.$L;var n=this.clone(),u=_(e,r,!0);return u&&(n.$L=u),n},t.clone=function(){return i.w(this.$d,this)},t.toDate=function(){return new Date(this.valueOf())},t.toJSON=function(){return this.isValid()?this.toISOString():null},t.toISOString=function(){return this.$d.toISOString()},t.toString=function(){return this.$d.toUTCString()},s}(),f=g.prototype;return c.prototype=f,[["$ms",P],["$s",y],["$m",S],["$H",L],["$W",T],["$M",b],["$y",k],["$D",C]].forEach(function(s){f[s[1]]=function(t){return this.$g(t,s[0],s[1])}}),c.extend=function(s,t){return s.$i||(s(t,g,c),s.$i=!0),c},c.locale=_,c.isDayjs=d,c.unix=function(s){return c(1e3*s)},c.en=a[F],c.Ls=a,c.p={},c})}(et)),et.exports}var _t=ht();const Z=st(_t);function vt(D){return Q({url:"/bigdata/realtime/v1.1/grid_poprank",method:"post",data:D})}function $t(D){return Q({url:"/bigdata/realtime/v1.1/region",method:"post",data:D})}function yt(D){return Q({url:"/bigdata/realtime/v1.1/region_grid_pop",method:"post",data:D})}function Mt(D){return Q({url:"/bigdata/realtime/v1.1/population",method:"post",data:D})}function mt(D){return Q({url:"/bigdata/realtime/v1.1/grid_basicinfo/list",method:"post",data:D})}const wt={class:"hot-list"},Dt={class:"rank"},bt={class:"name"},Ot={class:"count"},St="YNDBZ-OWO6Z-QOEXI-7AXSB-HCH4V-6DF6G",Tt={__name:"TencentMap3",setup(D){const A=I(["11260"]),O=I(),m=I([]),N=I([]),P=I(),y=I(),S=I();let L=0,T=0,E=I([]);function b(){document.getElementById("info");let a=new TMap.LatLng(L,T);O.value=new TMap.Map("container",{zoom:17,center:a}),m.value.forEach(o=>{var i,g,f,s;let d=new TMap.InfoWindow({map:O.value,position:o.position,offset:{x:90,y:0},content:`人流量 - ${(i=y.value)==null?void 0:i.time}：${o==null?void 0:o.count}`}),_=new TMap.InfoWindow({map:O.value,position:o.position2,offset:{x:90,y:-70},content:`区域人数 - ${(g=y.value)==null?void 0:g.time}：${(f=y.value)==null?void 0:f.value}`});o.grid_list;const c=[];(s=o.grid_list)==null||s.forEach((t,e)=>{var v,$,w,B,j,W,x,M,H;const r=(w=($=(v=t==null?void 0:t.point[0])==null?void 0:v.grid_location)==null?void 0:$.center_gcj)==null?void 0:w.split(","),n=new TMap.LatLng(r[0],r[1]),u=(W=(j=(B=t==null?void 0:t.point[0])==null?void 0:B.grid_location)==null?void 0:j.left_down_gcj)==null?void 0:W.split(","),l=(H=(M=(x=t==null?void 0:t.point[0])==null?void 0:x.grid_location)==null?void 0:M.right_upper_gcj)==null?void 0:H.split(","),p=[new TMap.LatLng(u[0],l[1]),new TMap.LatLng(u[0],u[1]),new TMap.LatLng(l[0],u[1]),new TMap.LatLng(l[0],l[1])],h=new TMap.InfoWindow({map:O.value,position:n,content:`网格人数：${t.grid_pop}`});c.push({grid_id:t.grid_id,obj:h}),new TMap.MultiPolygon({id:`polygon-layer${e}`,map:O.value,styles:{polygon:new TMap.PolygonStyle({color:"rgba(244,136,110,0.5)",showBorder:!0,borderColor:"#fff"})},geometries:[{id:`polygon${e}`,styleId:"polygon",paths:p,properties:{title:"polygon"}}]})}),N.value.push({id:o==null?void 0:o.id,obj:d,obj2:_,obj3:c})}),new TMap.MultiPolygon({map:O.value,geometries:E.value,styles:{polygon:new TMap.PolygonStyle({color:"#3777FF",showBorder:!1,borderColor:"#00FFFF"})}}),new TMap.MultiPolyline({map:O.value,zIndex:1,styles:{polygon:new TMap.PolylineStyle({color:"rgba(244,136,110,0.8)",showBorder:!1,borderColor:"#FF0000"}),highlight:new TMap.PolylineStyle({color:"rgba(244,136,110,0.8)",width:4,showBorder:!1,borderColor:"#fff",borderWidth:1})}})}async function U(a){try{const o=await $t({id:a,key:St});if(o.status===0){const d=o.data.center.split(",");L=d[0],T=d[1];const _=o.data.boundary.split("|"),c={paths:[]};m.value.forEach(i=>{i.id==a&&(i.position=new TMap.LatLng(o.data.upper_right.split(",")[0],o.data.upper_right.split(",")[1]),i.position2=new TMap.LatLng(o.data.upper_right.split(",")[0],o.data.upper_right.split(",")[1]))});for(let i=0;i<_.length;i++){const f=_[i].split(",");c.paths.push({lat:f[0]-0,lng:f[1]-0,height:0})}E.value.push(c),m.value}}catch{}}function k(a){return(a?Z(a):Z()).subtract(3,"minute").set("second",0).set("millisecond",0).unix()}function C(){let a=Z();a=a.subtract(5,"minute");const o=Math.floor(a.minute()/5)*5;return a=a.minute(o).second(0).millisecond(0),a}function X(){return Z(Z().startOf("hour").format("YYYY-MM-DD HH:00:00")).unix()}function z(){return Z(Z().startOf("hour").add(1,"hour").format("YYYY-MM-DD HH:00:00")).unix()}async function q(){var a,o,d,_,c;try{const i=await yt({region_ids:A.value,time:k((a=y.value)==null?void 0:a.time),key:"YNDBZ-OWO6Z-QOEXI-7AXSB-HCH4V-6DF6G"});i.status===0&&((o=i==null?void 0:i.data)==null||o.region_list,(d=m.value)!=null&&d.length?(_=m.value)==null||_.forEach(g=>{var s,t,e;const f=(t=(s=i==null?void 0:i.data)==null?void 0:s.region_list)==null?void 0:t.find(r=>r.region_id==g.id);g.count=(e=f==null?void 0:f.grid_list)==null?void 0:e.reduce((r,n)=>r+n.grid_pop,0),g.grid_list=f==null?void 0:f.grid_list}):m.value=(c=i==null?void 0:i.data)==null?void 0:c.region_list.map(g=>{var f;return{id:g==null?void 0:g.region_id,grid_list:g==null?void 0:g.grid_list,count:(f=g==null?void 0:g.grid_list)==null?void 0:f.reduce((s,t)=>s+t.grid_pop,0)}}))}catch(i){}}async function J(a){var d;X(),z();const o=await Mt({id:a,begin:X(),end:z(),interval:5,people_type:"all",key:"YNDBZ-OWO6Z-QOEXI-7AXSB-HCH4V-6DF6G"});y.value=o==null?void 0:o.data[((d=o==null?void 0:o.data)==null?void 0:d.length)-1],y.value}async function V(){const a=m.value[0];for(let o in a.grid_list){const d=await R({adcode:"310000",grid_ids:[a.grid_list[o].grid_id],key:"YNDBZ-OWO6Z-QOEXI-7AXSB-HCH4V-6DF6G"});a.grid_list[o].point=d}}async function R(a){var d;const o=await mt(a);return(d=o==null?void 0:o.data)==null?void 0:d.grid_list}const F=async()=>{var a,o,d,_;try{const c=await vt({adcode:"310000",time:k((a=y.value)==null?void 0:a.time),rank_type:0,key:"YNDBZ-OWO6Z-QOEXI-7AXSB-HCH4V-6DF6G"});S.value=(d=(o=c.data)==null?void 0:o.list)==null?void 0:d.splice(0,10);const i=(_=S.value)==null?void 0:_.map(f=>f.grid_id),g=await R({adcode:"310000",grid_ids:i,key:"YNDBZ-OWO6Z-QOEXI-7AXSB-HCH4V-6DF6G"});S.value.forEach((f,s)=>{var t;f.grid_name=(t=g[s])==null?void 0:t.grid_name})}catch(c){}};return at(async()=>{F(),C();for(let a in A.value)await J(A.value[a]);await q();for(let a in A.value)await U(A.value[a]);await V(),b(),P.value=setInterval(async()=>{for(let a in A.value)await J(A.value[a]);await q(),F(),N.value.forEach(a=>{var d,_,c,i,g;const o=(d=m.value)==null?void 0:d.find(f=>f.id==a.id);a.obj.setContent(`人流量 - ${(_=y.value)==null?void 0:_.time}：${o==null?void 0:o.count}`),a.obj2.setContent(`区域人数 - ${(c=y.value)==null?void 0:c.time}：${(i=y.value)==null?void 0:i.value}`),((g=a==null?void 0:a.obj3)==null?void 0:g.length)>0&&a.obj3.forEach(f=>{var t;const s=(t=o.grid_list)==null?void 0:t.find(e=>e.grid_id==f.grid_id);f.obj.setContent(`网格人数：${s.grid_pop}`)})})},6e4)}),ut(()=>{clearInterval(P.value)}),(a,o)=>(tt(),nt(ot,null,[o[1]||(o[1]=Y("div",{id:"container"},null,-1)),o[2]||(o[2]=Y("div",{id:"info",style:{width:"100%",height:"500px"}},null,-1)),Y("div",wt,[o[0]||(o[0]=Y("li",null,[Y("span",{class:"rank"},"排名"),Y("span",{class:"name"},"位置"),Y("span",{class:"count"},"人数")],-1)),(tt(!0),nt(ot,null,lt(S.value,(d,_)=>(tt(),nt("li",{key:_},[Y("span",Dt,rt(d.rank),1),Y("span",bt,rt(d.grid_name),1),Y("span",Ot,rt(d.grid_pop),1)]))),128))])],64))}},kt=pt(Tt,[["__scopeId","data-v-fc428355"]]),xt=ct({__name:"index",setup(D){return dt().roles.includes("admin"),(O,m)=>(tt(),ft(kt))}});export{xt as default};
